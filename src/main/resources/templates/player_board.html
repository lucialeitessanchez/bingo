<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Bingo - Player</title>
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/images/bingoIcon.png}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta http-equiv="refresh" content="5">
</head>

<body class="bg-light">

    <div class="container d-flex justify-content-center align-items-center min-vh-100">
        <div class="main-container bg-white rounded-4 shadow p-4 w-100" style="max-width: 700px;">

            <!-- TÃ­tulo -->
            <h2 class="text-center mb-4">
                Welcome <span th:text="${player.name}" class="fw-bold"></span> to the <span class="text-primary">BINGO!</span>
            </h2>

            <!-- Mensajes -->
            <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>
            <div th:if="${message}" class="alert alert-success text-center" th:text="${message}"></div>

            <!-- Script de alerta del juego -->
            <script th:if="${!gameActive and winnerId != null}">
                const winnerIdJs = '[[${winnerId}]]';
                const playerIdJs = '[[${player.id}]]';
                
                let titleText, messageText, backgroundStyle;

                if (winnerIdJs === playerIdJs) {
                    titleText = "Â¡BINGO! ðŸŽ‰";
                    messageText = "Â¡Congrats, you're the winner!";
                    backgroundStyle = "white url(/images/confeti.gif)";
                } else {
                    titleText = "Â¡GAME OVER!";
                    messageText = "The winner is: " + winnerIdJs;
                    backgroundStyle = "white url(/images/cat.gif)";
                }

                Swal.fire({
                    title: titleText,
                    html: messageText,
                    width: 600,
                    padding: "3em",
                    color: "#716add",
                    background: backgroundStyle,
                });
            </script>

            <!-- Estado del juego -->
            <div class="status text-center mt-3 mb-4" th:if="${!gameActive and winnerId == null}">
                <h4 class="text-muted">Waiting to start the game...</h4>
            </div>

            <!-- Tablero del jugador -->
            <div class="board-container">
                <div class="row g-3 justify-content-center">
                    <div th:each="phrase, iterStat : ${player.board}"
                         class="col-4 d-flex justify-content-center align-items-center">

                        <form th:action="@{/player/{playerId}/mark(playerId=${player.id})}" method="post" class="w-100">
                            <input type="hidden" name="phrase" th:value="${phrase}">
                            
                            <button type="submit"
                                    th:text="${phrase}"
                                    th:disabled="${!gameActive or player.markedStatus[__${iterStat.index}__]}"
                                    class="btn w-100 py-3 fw-semibold"
                                    th:classappend="${player.markedStatus[__${iterStat.index}__] ? 'btn-success marked' : 'btn-outline-secondary'}">
                            </button>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>

</body>
</html>
