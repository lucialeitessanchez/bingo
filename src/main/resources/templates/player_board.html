<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Bingo - Player</title>
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/images/bingoIcon.png}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta http-equiv="refresh" content="5"> </head>
<body>
    <br>
    <div class="container">
    <h2>Welcome <span th:text="${player.name}">to the BINGO</span></h2>

        <div th:if="${error}" class="message error" th:text="${error}"></div>
        <div th:if="${message}" class="message success" th:text="${message}"></div>

   <script th:if="${!gameActive and winnerId != null}">
    // Bloque que se ejecuta SOLO si el juego terminÃ³ y hay un ganador
    
    // CORRECCIÃ“N CLAVE: Usar comillas simples ' ' alrededor de las variables Thymeleaf
    const winnerIdJs = '[[${winnerId}]]';
    const playerIdJs = '[[${player.id}]]';
    
    let titleText, messageText, iconType;
    let backgroundStyle;
    
    // 1. Determinar el mensaje y el estilo segÃºn el resultado
    if (winnerIdJs === playerIdJs) {
        // El jugador actual ganÃ³
        titleText = "Â¡BINGO! ðŸŽ‰";
        messageText = "Â¡Congrats, you're the win!";
        backgroundStyle = "white url(/images/confeti.gif)"; 
    } else {
        // El jugador actual perdiÃ³
        titleText = "Â¡GAME OVER!";
        messageText = "The win is: " + winnerIdJs;
        backgroundStyle = "white url(/images/cat.gif)";
    }

    // 2. Ejecutar la alerta de SweetAlert2 (Â¡ESTE CÃ“DIGO FALTABA!)
    Swal.fire({
        title: titleText,
        html: messageText, // Usamos 'html' para permitir etiquetas si fuera necesario, sino 'text'.
        icon: iconType,
        width: 600,
        padding: "3em",
        color: "#716add",
        background: backgroundStyle,
    });
    
</script>
        <div class="status" th:if="${!gameActive and winnerId == null}">
            <h2>Waiting to start the game...</h2>
        </div>

      <div class="container mt-4">
    <div class="row g-3 justify-content-center"> 
        
        <div th:each="phrase, iterStat : ${player.board}" 
             class="col-4 board-cell-bootstrap"> 
             
             <form th:action="@{/player/{playerId}/mark(playerId=${player.id})}" method="post">
                <input type="hidden" name="phrase" th:value="${phrase}">
                
                <button type="submit" 
                        th:text="${phrase}" 
                        th:disabled="${!gameActive or player.markedStatus[__${iterStat.index}__]}"
                        class="btn w-100 h-100"
                        th:classappend="${player.markedStatus[__${iterStat.index}__] ? 'btn-success marked' : 'btn-light'}">
                </button>
            </form>
        </div>
        
    </div>
</div>
    
    </div>
</body>
</html>