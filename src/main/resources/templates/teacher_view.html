<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Teacher's Dashboard</title>
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/images/bingoIcon.png}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container d-flex justify-content-center align-items-center min-vh-100">
        <div class="main-container bg-white rounded-4 shadow p-4 w-100" style="max-width: 900px;">


            <!-- Mensajes -->
            <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>
            <div th:if="${message}" class="alert alert-success text-center" th:text="${message}"></div>

            <!-- Nueva tarjeta -->
            <div th:if="${newCardText}" class="card mx-auto mb-4 text-center"
                 th:style="'background-color:' + ${newCardColor} + '; width: 250px;'">
                <div class="card-body">
                    <img th:src="@{'/images/juguetes/' + ${newCardObject} + '.png'}"
                         th:alt="${newCardText}"
                         class="card-toy-image img-fluid" />
                </div>
            </div>

            <!-- Estado del juego -->
            <div class="status-bar text-center mb-4">
                <p>Player connected:
                    <span th:text="${playerCount}"></span> /
                    <span th:text="${maxPlayers}"></span>
                </p>
                <p th:if="${gameActive}" class="text-success fw-bold">STATE: STARTED GAME</p>
                <p th:if="${!gameActive and winnerId == null}" class="text-warning fw-bold">STATE: WAITING...</p>
                <p th:if="${winnerId != null}" class="text-danger fw-bold">WIN:
                    <span th:text="${winnerId}"></span> - ¡GAME FINISH!
                </p>
            </div>

            <!-- Controles -->
            <div class="controls text-center mb-4">
                <form th:action="@{/teacher/start}" method="post" th:if="${!gameActive and playerCount > 0}" class="d-inline">
                    <button type="submit" class="btn btn-info">Start game</button>
                </form>

                <div th:if="${!gameActive and playerCount == 0}" class="alert alert-warning mt-3">
                    <p>No players connected to start the game</p>
                </div>

                <div class="btn-group mt-3" role="group" aria-label="Basic example">
                    <form th:action="@{/teacher/next-phrase}" method="post" th:if="${gameActive and winnerId == null}">
                        <button type="submit" class="btn btn-primary">Generate new Phrase</button>
                    </form>

                    <form th:action="@{/teacher/reset}" method="post">
                        <button type="submit" class="btn btn-outline-warning"
                            onclick="return confirm('¿Seguro que quieres resetear el juego y eliminar jugadores?')">
                            Reset players
                        </button>
                    </form>
                </div>
            </div>

            <hr/>

            <!-- QR o estado -->
            <div th:if="${!gameActive and winnerId == null}" class="game-info-panel text-center">
                <h2>Scan QR to join the game</h2>
                <img th:src="@{/teacher/qr-code.png}" alt="Código QR para unirse al juego"
                     class="qr-code-image img-fluid mt-3" style="max-width: 300px;">
            </div>

            <div th:if="${gameActive and winnerId == null}" class="game-info-panel active-game-image text-center mt-4">
                <!-- Imagen o animación del juego activo -->
            </div>

            <!-- Historial -->
            <div class="history mt-5">
                <h2 class="text-center mb-3">Shown toys</h2>
                <ul th:if="${!historyPhrases.isEmpty()}" class="phrase-list list-unstyled text-center">
                    <li th:each="entry : ${historyPhrases}" class="mb-2">
                        <div class="toy-colored d-inline-block me-2"
                             th:style="'--toy-color: ' + ${entry.color} +
                                       '; --toy-mask-url: url(\'/images/juguetes/' + ${entry.toy} + '.png\');'
                                      + 'width: 40px; height: 40px; display: inline-block;'">
                        </div>
                        <span th:text="${entry.phrase}" class="fw-semibold"></span>
                    </li>
                </ul>
                <p th:if="${historyPhrases.isEmpty()}" class="text-center text-muted">Any toy shown</p>
            </div>

        </div>
    </div>

</body>
</html>
